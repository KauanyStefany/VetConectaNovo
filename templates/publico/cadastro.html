{% extends "base_publica.html" %}

{% block title %}Cadastro{% endblock %}

{% block conteudo %}
<div class="bg-img-animais">
    <div class="container">
        <div class="row justify-content-center align-items-center flex-grow-1">
            <div class="col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5">
                <div class="card shadow-lg rounded-4 border-0 bg-white bg-opacity-75">
                    <div class="card-body p-4 p-md-5 text-center">
                        <!-- Título -->
                        <h5 class="mb-4 fw-semibold fs-2">Cadastro</h5>

                        <!-- Formulário -->
                        <form action="/cadastro" method="post" class="text-start">

                            <!-- Alerta de erro geral -->
                            {% if erros and erros.geral %}
                            <div class="alert alert-danger" role="alert">
                                {{ erros.geral }}
                            </div>
                            {% endif %}

                            <!-- Seleção de perfil -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Se cadastrar como:</label>
                                <div class="btn-group w-100" role="group" aria-label="Seleção de perfil">
                                    <input type="radio" class="btn-check" name="perfil" id="tutor" value="tutor"
                                        required {% if dados and dados.perfil=='tutor' %}checked{% endif %}>
                                    <label class="btn btn-outline-laranja w-50" for="tutor">Tutor</label>

                                    <input type="radio" class="btn-check" name="perfil" id="veterinario"
                                        value="veterinario" required {% if dados and dados.perfil=='veterinario'
                                        %}checked{% endif %}>
                                    <label class="btn btn-outline-laranja w-50" for="veterinario">Veterinário</label>
                                </div>
                                {% if erros and erros.perfil %}
                                <div class="invalid-feedback d-block">{{ erros.perfil }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Nome -->
                            <div class="mb-3">
                                <label for="nome" class="form-label fw-bold">Nome</label>
                                <input type="text"
                                    class="form-control {% if erros and erros.nome %}is-invalid{% endif %}" id="nome"
                                    name="nome" value="{{ dados.nome if dados else '' }}" placeholder="Digite seu nome"
                                    required>
                                {% if erros and erros.nome %}
                                <div class="invalid-feedback">{{ erros.nome }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Email -->
                            <div class="mb-3">
                                <label for="email" class="form-label fw-bold">E-mail</label>
                                <input type="email"
                                    class="form-control {% if erros and erros.email %}is-invalid{% endif %}" id="email"
                                    name="email" value="{{ dados.email if dados else '' }}"
                                    placeholder="Digite seu e-mail" required>
                                {% if erros and erros.email %}
                                <div class="invalid-feedback">{{ erros.email }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Telefone -->
                            <div class="mb-3">
                                <label for="telefone" class="form-label fw-bold">Telefone</label>
                                <input type="tel"
                                    class="form-control {% if erros and erros.telefone %}is-invalid{% endif %}"
                                    id="telefone" name="telefone" value="{{ dados.telefone if dados else '' }}"
                                    placeholder="Digite seu telefone" required>
                                {% if erros and erros.telefone %}
                                <div class="invalid-feedback">{{ erros.telefone }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo CRMV (somente se Veterinário) -->
                            <div class="mb-3" id="crmv-field" style="display: none;">
                                <label for="crmv" class="form-label fw-bold">CRMV</label>
                                <input type="text"
                                    class="form-control {% if erros and erros.crmv %}is-invalid{% endif %}" id="crmv"
                                    name="crmv" value="{{ dados.crmv if dados else '' }}" placeholder="Digite seu CRMV">
                                {% if erros and erros.crmv %}
                                <div class="invalid-feedback">{{ erros.crmv }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Senha -->
                            <div class="mb-3">
                                <label for="senha" class="form-label fw-bold">Senha</label>
                                <input type="password"
                                    class="form-control {% if erros and erros.senha %}is-invalid{% endif %}" id="senha"
                                    name="senha" placeholder="Digite sua senha" required>
                                {% if erros and erros.senha %}
                                <div class="invalid-feedback">{{ erros.senha }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Confirmar Senha -->
                            <div class="mb-3">
                                <label for="confirmar_senha" class="form-label fw-bold">Confirmar Senha</label>
                                <input type="password"
                                    class="form-control {% if erros and erros.confirmar_senha %}is-invalid{% endif %}"
                                    id="confirmar_senha" name="confirmar_senha" placeholder="Confirme sua senha"
                                    required>
                                {% if erros and erros.confirmar_senha %}
                                <div class="invalid-feedback">{{ erros.confirmar_senha }}</div>
                                {% endif %}
                            </div>

                            <!-- Campo Termos -->
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="termos" name="termos" required {% if
                                    dados and dados.termos %}checked{% endif %}>
                                <label class="form-check-label" for="termos">
                                    Aceito os
                                    <a href="/termos" class="text-primary fw-semibold text-decoration-none">Termos de
                                        privacidade.</a>
                                </label>
                                {% if erros and erros.termos %}
                                <div class="invalid-feedback d-block">{{ erros.termos }}</div>
                                {% endif %}
                            </div>

                            <!-- Botão de Envio do Formulário -->
                            <button type="submit"
                                class="btn bg-laranja text-white w-100 fw-semibold py-2 mb-4 rounded-3">
                                Cadastrar
                            </button>
                        </form>

                        <!-- Link para Login -->
                        <div class="text-center border-top border-laranja pt-3">
                            <span class="text-muted">Já tem uma conta cadastrada?</span>
                            <a href="/login" class="text-primary fw-semibold text-decoration-none ms-1">Faça login!</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tutorRadio = document.getElementById('tutor');
        const tutorLabel = document.querySelector('label[for="tutor"]');
        const veterinarioRadio = document.getElementById('veterinario');
        const veterinarioLabel = document.querySelector('label[for="veterinario"]');
        const crmvField = document.getElementById('crmv-field');
        const crmvInput = document.getElementById('crmv');

        function toggleCrmvField() {
            if (veterinarioRadio.checked) {
                crmvField.style.display = 'block';
                crmvInput.setAttribute('required', 'required');
                veterinarioLabel.classList.remove('btn-outline-laranja');
                veterinarioLabel.classList.add('border-laranja', 'bg-laranja', 'text-branco');
                tutorLabel.classList.remove('border-laranja', 'bg-laranja', 'text-branco');
                tutorLabel.classList.add('btn-outline-laranja');
            } else {
                crmvField.style.display = 'none';
                crmvInput.removeAttribute('required');
                tutorLabel.classList.remove('btn-outline-laranja');
                tutorLabel.classList.add('border-laranja', 'bg-laranja', 'text-branco');
                veterinarioLabel.classList.remove('border-laranja', 'bg-laranja', 'text-branco');
                veterinarioLabel.classList.add('btn-outline-laranja');
            }
        }

        tutorRadio.addEventListener('change', toggleCrmvField);
        veterinarioRadio.addEventListener('change', toggleCrmvField);

        // Inicializa o campo corretamente ao carregar a página
        toggleCrmvField();
    });
</script>
{% endblock %}