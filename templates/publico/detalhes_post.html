{% extends "base_publica.html" %}

{% block title %}Post de {{ post.nome_tutor }}{% endblock %}

{% block conteudo %}

<div class="container">
    <!-- Cabeçalho do Post -->
    <div class="row mb-4">
        <div class="col-12">
            <!-- Metadados -->
            <div class="d-flex flex-wrap gap-3 align-items-center">
                <!-- Data da Postagem -->
                <span class="text-muted">
                    <i class="bi bi-calendar-event me-1"></i>
                    {{ post.data_postagem[:10] | replace('-', '/') if post.data_postagem is string else post.data_postagem.strftime('%d/%m/%Y') }}
                </span>

                <!-- Visualizações -->
                <span class="text-muted">
                    <i class="bi bi-eye me-1"></i>
                    {{ post.visualizacoes }} visualizaç{{ 'ões' if post.visualizacoes != 1 else 'ão' }}
                </span>

                <!-- Curtidas -->
                <span class="text-muted">
                    <i class="bi bi-heart-fill text-danger me-1"></i>
                    {{ total_curtidas }} curtida{{ 's' if total_curtidas != 1 else '' }}
                </span>

                <!-- Comentários -->
                <span class="text-muted">
                    <i class="bi bi-chat-dots me-1"></i>
                    Comentários em breve!
                </span>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Conteúdo Principal -->
        <div class="col-lg-8">
            <!-- Imagem do Post -->
            <div class="mb-4">
                <img src="/static/img/feeds/{{ '%08d' % post.id_postagem_feed }}.jpg"
                     alt="Post de {{ post.nome_tutor }}"
                     class="img-fluid rounded shadow-sm w-100"
                     style="max-height: 600px; object-fit: cover;"
                     onerror="this.src='/static/img/default-post.jpg'">
            </div>

            <!-- Card da Descrição -->
            {% if post.descricao %}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h6 class="text-muted mb-3">
                        <i class="bi bi-chat-quote me-2"></i>Descrição
                    </h6>
                    <p class="mb-0" style="line-height: 1.8; white-space: pre-wrap;">{{ post.descricao }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Botão de Curtir -->
            {% if request.session.get('usuario') %}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4 text-center">
                    <p class="mb-3 text-muted">Gostou deste post?</p>
                    {% if usuario_curtiu %}
                    <button class="btn btn-danger btn-lg px-5" disabled>
                        <i class="bi bi-heart-fill me-2"></i>Você curtiu este post
                    </button>
                    {% else %}
                    <button class="btn btn-outline-danger btn-lg px-5" onclick="alert('Funcionalidade de curtir em breve!')">
                        <i class="bi bi-heart me-2"></i>Curtir este post
                    </button>
                    {% endif %}
                    <p class="mt-3 mb-0 small text-muted">
                        {{ total_curtidas }} pessoa{{ 's' if total_curtidas != 1 else '' }} curti{{ 'ram' if total_curtidas != 1 else 'u' }} este post
                    </p>
                </div>
            </div>
            {% else %}
            <div class="card border-0 shadow-sm mb-4 bg-light">
                <div class="card-body p-4 text-center">
                    <p class="mb-3">Gostou deste post? Faça login para curtir!</p>
                    <a href="/login" class="btn btn-roxo text-white btn-lg px-5">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Fazer Login
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Seção de Comentários (Placeholder) -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-chat-dots me-2"></i>Comentários
                    </h5>
                </div>
                <div class="card-body p-4 text-center text-muted">
                    <i class="bi bi-chat-dots" style="font-size: 3rem;"></i>
                    <p class="mt-3 mb-0">Sistema de comentários em breve!</p>
                </div>
            </div>
        </div>

        <!-- Sidebar - Informações do Tutor -->
        <div class="col-lg-4">
            <!-- Card do Tutor -->
            <div class="card border-0 shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-roxo text-white text-center py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-person-circle me-2"></i>Sobre o Tutor
                    </h5>
                </div>
                <div class="card-body p-4">
                    <!-- Foto do Tutor -->
                    <div class="text-center mb-3">
                        <img src="/static/img/usuarios/{{ '%08d' % post.id_usuario }}.jpg"
                             alt="{{ post.nome_tutor }}"
                             class="rounded-circle shadow mb-3"
                             style="width: 120px; height: 120px; object-fit: cover;"
                             onerror="this.src='/static/img/default-avatar.jpg'">
                    </div>

                    <!-- Nome do Tutor -->
                    <div class="text-center mb-3">
                        <h5 class="fw-bold text-roxo mb-1">{{ post.nome_tutor }}</h5>
                        <small class="text-muted">@{{ post.nome_tutor.lower().replace(' ', '') }}</small>
                    </div>

                    <!-- Informações do Tutor -->
                    <div class="mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted">
                                <i class="bi bi-envelope me-1"></i>Email
                            </small>
                        </div>
                        <small class="text-break">{{ post.email_tutor }}</small>
                    </div>

                    {% if post.telefone_tutor %}
                    <div class="mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted">
                                <i class="bi bi-telephone me-1"></i>Telefone
                            </small>
                        </div>
                        <small>{{ post.telefone_tutor }}</small>
                    </div>
                    {% endif %}

                    {% if post.quantidade_pets %}
                    <div class="mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted">
                                <i class="bi bi-heart me-1"></i>Pets
                            </small>
                        </div>
                        <small>{{ post.quantidade_pets }} pet{{ 's' if post.quantidade_pets != 1 else '' }}</small>
                    </div>
                    {% endif %}

                    <!-- Estatísticas do Post -->
                    <hr class="my-3">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="p-2">
                                <i class="bi bi-eye text-roxo" style="font-size: 1.5rem;"></i>
                                <div class="fw-bold text-roxo mt-1">{{ post.visualizacoes }}</div>
                                <small class="text-muted">Visitas</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-2">
                                <i class="bi bi-heart-fill text-danger" style="font-size: 1.5rem;"></i>
                                <div class="fw-bold text-danger mt-1">{{ total_curtidas }}</div>
                                <small class="text-muted">Curtidas</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-2">
                                <i class="bi bi-chat-dots" style="font-size: 1.5rem;"></i>
                                <div class="fw-bold text-danger mt-1">{{ total_comentarios or 0 }}</div>
                                <small class="text-muted">Comentários</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block head %}
<style>
    .btn-roxo {
        background-color: var(--cor-roxo);
        border-color: var(--cor-roxo);
    }

    .btn-roxo:hover {
        background-color: #362947;
        border-color: #362947;
    }

    .btn-outline-roxo {
        border-color: var(--cor-roxo);
        color: var(--cor-roxo);
    }

    .btn-outline-roxo:hover {
        background-color: var(--cor-roxo);
        border-color: var(--cor-roxo);
        color: #fff;
    }

    @media (max-width: 991px) {
        .sticky-top {
            position: relative !important;
            top: auto !important;
        }
    }
</style>
{% endblock %}
